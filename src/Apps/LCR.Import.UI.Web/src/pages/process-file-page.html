<template>
  <require from="components/pagination-component"></require>
  <require from="resources/value-converters/date-time-value-converter"></require>
  <require from="resources/binding-behaviors/intercept-binding-behavior"></require>
  <require from="resources/custom-attributes/date-picker-custom-attribute"></require>
  <require from="./process-file-page.scss"></require>
  <article>
    <section class="uk-padding-small">
      <ul class="uk-breadcrumb">
        <li><a route-href="route: root">История</a></li>
        <li><a route-href="route: upload-file">Загрузка файла</a></li>
        <li><span>Обработка файла</span></li>
      </ul>
    </section>
    <template if.bind="importStep != 2">
      <section class="uk-flex uk-flex-column uk-flex-center uk-flex-middle">
        <div uk-spinner="ratio: 2"></div>
        <div class="uk-text-normal">${importStatus}</div>
      </section>
    </template>
    <template if.bind="importStep == 2">
      <section>
        <template if.bind="paginationData">
          <pagination-component current-page.bind="paginationData.currentPageNumber"
                                total-pages.bind="paginationData.totalPages"
                                route-config.bind="currentRouteConfig"
                                route-params.bind="currentRouteParams">

          </pagination-component>
        </template>
        <div class="uk-overflow-auto">
          <table class="uk-table uk-table-divider uk-table-striped uk-table-hover">
            <thead>
              <tr>
                <th colspan="10" class="uk-text-center">
                  Данные из файла
                </th>
                <th colspan="4" class="uk-text-center">
                  Данные из LCR
                </th>
              </tr>
              <tr>
                <th></th>
                <th>№ строки</th>
                <th>Транковая группа</th>
                <th>Оператор-владелец коммутатора</th>
                <th>Полное наименование оператора</th>
                <th>Тип направления</th>
                <th>Исх./Вх.</th>
                <th>Уровень присоединения оператора</th>
                <th>Уроверь присоединения Ростелеком</th>
                <th>Дата начала действия</th>
                <th>Дата закрытия</th>
                <th>Carrier</th>
                <th>Direction</th>
                <th>ValidFrom</th>
                <th>ValidUntil</th>
              </tr>
            </thead>
            <tbody>
              <tr repeat.for="entry of uploadResultData">
                <td style="min-width: 50px;">
                  <button class="uk-button uk-button-link uk-button-small" uk-tooltip="Утвердить" style="color: green;">
                    <span uk-icon="icon: check"></span>
                  </button>
                  <button class="uk-button uk-button-link uk-button-small" uk-tooltip="Исключить" style="color: red;">
                    <span uk-icon="icon: ban"></span>
                  </button>
                </td>
                <td>${entry.dataRowId}</td>
                <td>${entry.channelBundleName}</td>
                <td>${entry.switchOperatorName}</td>
                <td>${entry.pairedSwitchOperatorFullName}</td>
                <td>${entry.directionType}</td>
                <td>${entry.fileDirection == '1' ? 'I' : 'O'}</td>
                <td>${entry.operatorsNetworkConnectionLvl}</td>
                <td>${entry.rtNetworkConnectionLevel}</td>
                <td class.bind="entry.flags & intercept:flagFunc:4">
                  ${entry.fileDateOpen | shortDate}
                </td>
                <td class.bind="entry.flags & intercept:flagFunc:8">
                  ${entry.fileDateClose | shortDate}
                </td>
                <td>${entry.lcrSwitchOperatorId}</td>
                <td>${entry.lcrDirection == '1' ? 'I' : 'O'}</td>
                <td class.bind="entry.flags & intercept:flagFunc:4">
                  ${entry.lcrDateOpen | shortDate}
                </td>
                <td class.bind="entry.flags & intercept:flagFunc:8" style="width:200px;" click.delegate="editModes[entry.dataRowId]=true">
                  <!--<template if.bind="editModes[entry.dataRowId]">
                    <input datepicker="format.bind: 'L'" type="text" value.bind="entry.lcrDateClose" class="uk-input uk-form-small" change.delegate="editModes[entry.dataRowId]=false" />
                  </template>-->
                  <!--<template else>-->
                  ${entry.lcrDateClose | shortDate}
                  <!--</template>-->
                </td>
              </tr>
            </tbody>
          </table>
          <template if.bind="isLoadInProggress">
            <div style="position: relative;">
              <div uk-spinner class="uk-position-center"></div>
            </div>
          </template>
        </div>
        <template if.bind="paginationData">
          <pagination-component current-page.bind="paginationData.currentPageNumber"
                                total-pages.bind="paginationData.totalPages"
                                route-config.bind="currentRouteConfig"
                                route-params.bind="currentRouteParams">

          </pagination-component>
        </template>
      </section>
    </template>
  </article>
</template>
